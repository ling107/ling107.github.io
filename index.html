<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>å•è¯æ¶ˆæ¶ˆä¹</title>
    <link rel="stylesheet" href="./style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
</head>
<body>
    <!-- ç²’å­èƒŒæ™¯æ•ˆæœ -->
    <div class="particles" id="particles"></div>

    <!-- å›¾ç‰‡å®¹å™¨ - ç”¨äºæ˜¾ç¤ºç•Œé¢æˆªå›¾ -->
    <div id="imageContainer" style="display: none;">
        <img src="https://haisnap.tos-cn-beijing.volces.com/image/358134c5-df1d-47b1-8b51-44819db7cb01_1754214042434.jpg" alt="ç•Œé¢æˆªå›¾" style="max-width: 100%; height: auto;">
    </div>

    <div class="container">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <div class="text-center mb-8">
            <h1 id="gameTitle" class="game-title text-6xl font-bold cursor-pointer hover:scale-105 transition-transform duration-300">
                å•è¯æ¶ˆæ¶ˆä¹
            </h1>
        </div>

        <!-- èœå•åŒºåŸŸ -->
        <div class="menu-section">
            <!-- å•è¯æ•°é‡æ»‘å— -->
            <div class="menu-item">
                <label class="text-lg font-semibold text-gray-700 min-w-max">å•è¯æ•°é‡ï¼š</label>
                <div class="slider-container">
                    <input type="range" id="wordCountSlider" class="slider" min="5" max="50" value="10">
                    <div id="wordCountDisplay" class="word-count-display">10å¯¹</div>
                </div>
            </div>

            <!-- å¯¼å…¥è¯è¡¨å’Œå¼€å§‹æ¸¸æˆæŒ‰é’® -->
            <div class="menu-item">
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls,.csv">
                <button id="importBtn" class="btn btn-secondary">
                    ğŸ“ å¯¼å…¥è¯è¡¨
                </button>
                <button id="startBtn" class="btn btn-primary">
                    ğŸ® å¼€å§‹æ¸¸æˆ
                </button>
                <button id="wordListBtn" class="btn btn-secondary">
                    ğŸ“– å•è¯è¡¨
                </button>
                <button id="settingsBtn" class="btn btn-secondary">
                    âš™ï¸ è®¾ç½®
                </button>
                <button id="statsBtn" class="btn btn-secondary">
                    ğŸ“Š ç»Ÿè®¡
                </button>
            </div>
        </div>

        <!-- è®¾ç½®é¢æ¿ -->
        <div id="settingsPanel" class="settings-panel">
            <div class="settings-header">
                <h3 class="settings-title">æ¸¸æˆè®¾ç½®</h3>
                <button class="settings-close" id="closeSettings">Ã—</button>
            </div>
            
            <!-- å‘éŸ³è®¾ç½® -->
            <div class="settings-group">
                <label class="settings-label">ğŸ”Š å‘éŸ³è®¾ç½®</label>
                <div class="settings-toggle">
                    <label class="toggle-switch">
                        <input type="checkbox" id="soundToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="toggle-label">å¯ç”¨å‘éŸ³</span>
                </div>
                <div class="settings-toggle">
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoPlayToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="toggle-label">ç‚¹å‡»å•è¯æ—¶è‡ªåŠ¨å‘éŸ³</span>
                </div>
                <div class="voice-type-setting">
                    <label class="settings-label">å‘éŸ³ç±»å‹</label>
                    <select id="voiceTypeSelect" class="voice-select">
                        <option value="en-US">ç¾å¼å‘éŸ³ (en-US)</option>
                        <option value="en-GB">è‹±å¼å‘éŸ³ (en-GB)</option>
                    </select>
                </div>
                <div class="voice-selection">
                    <label class="settings-label">é€‰æ‹©è¯­éŸ³</label>
                    <select id="voiceSelect" class="voice-select">
                        <option value="">é»˜è®¤è¯­éŸ³</option>
                    </select>
                </div>
            </div>

            <!-- å¯¼å…¥è®¾ç½® -->
            <div class="settings-group">
                <label class="settings-label">ğŸ“¥ å¯¼å…¥è®¾ç½®</label>
                <div class="import-settings-group">
                    <div class="column-setting">
                        <label>å•è¯åˆ—ï¼š</label>
                        <input type="number" id="wordColumnInput" class="column-input" min="0" value="0" placeholder="0">
                        <span class="column-hint">(ä»0å¼€å§‹è®¡æ•°)</span>
                    </div>
                    <div class="column-setting">
                        <label>é‡Šä¹‰åˆ—ï¼š</label>
                        <input type="number" id="meaningColumnInput" class="column-input" min="0" value="1" placeholder="1">
                        <span class="column-hint">(ä»0å¼€å§‹è®¡æ•°)</span>
                    </div>
                    <div class="column-setting">
                        <label>èµ·å§‹è¡Œï¼š</label>
                        <input type="number" id="startRowInput" class="column-input" min="0" value="0" placeholder="0">
                        <span class="column-hint">(ä»0å¼€å§‹è®¡æ•°)</span>
                    </div>
                    <div class="import-hint">
                        <small>ğŸ’¡ æç¤ºï¼šExcelè¡¨æ ¼çš„åˆ—ä»0å¼€å§‹è®¡æ•°ï¼Œç¬¬ä¸€åˆ—ä¸º0ï¼Œç¬¬äºŒåˆ—ä¸º1ï¼Œä»¥æ­¤ç±»æ¨</small>
                    </div>
                </div>
            </div>

            <!-- ç•Œé¢è®¾ç½® -->
            <div class="settings-group">
                <label class="settings-label">ğŸ¨ ç•Œé¢è®¾ç½®</label>
                <div class="settings-toggle">
                    <label class="toggle-switch">
                        <input type="checkbox" id="darkModeToggle">
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="toggle-label">æš—è‰²æ¨¡å¼</span>
                </div>
                <div class="animation-speed-setting">
                    <label class="settings-label">åŠ¨ç”»é€Ÿåº¦</label>
                    <div class="slider-container">
                        <input type="range" id="animationSpeedSlider" class="slider" min="0.5" max="2" step="0.1" value="1">
                        <div id="animationSpeedDisplay" class="word-count-display">1x</div>
                    </div>
                </div>
            </div>

            <!-- ä¿å­˜è®¾ç½®æŒ‰é’® -->
            <div class="modal-buttons">
                <button id="saveSettingsBtn" class="btn btn-success">
                    ğŸ’¾ ä¿å­˜è®¾ç½®
                </button>
            </div>
        </div>

        <!-- è®¡æ—¶åŒºåŸŸ -->
        <div class="timer-section">
            <div class="timer-display">
                è€—æ—¶ï¼š<span id="gameTime" class="timer-number">0ç§’</span>
            </div>
        </div>

        <!-- æ¸¸æˆé¢æ¿ -->
        <div id="gameBoard" class="game-board word-panel">
            <div class="col-span-full text-center text-gray-500 text-lg">
                è¯·å…ˆå¯¼å…¥å•è¯è¡¨
            </div>
        </div>
    </div>

    <!-- å¼€å§‹æ¸¸æˆé€‰é¡¹æ¨¡æ€æ¡† - ä¼˜åŒ–æ¸¸æˆæ¨¡å¼é€‰æ‹©ç•Œé¢ -->
    <div id="startGameModal" class="modal hidden">
        <div class="modal-content animate__animated">
            <h2 class="modal-title">é€‰æ‹©æ¸¸æˆæ¨¡å¼</h2>
            
            <div class="start-game-options">
                <div class="start-option">
                    <div class="option-icon">ğŸ”„</div>
                    <div class="option-title">å…¨éƒ¨é‡æ–°å¼€å§‹</div>
                    <div class="option-description">é‡ç½®æ‰€æœ‰è¿›åº¦ï¼Œä»ç¬¬ä¸€ä¸ªå•è¯å¼€å§‹</div>
                    <button class="option-btn btn btn-primary" onclick="selectGameMode('reset')">
                        å¼€å§‹æ–°æ¸¸æˆ
                    </button>
                </div>
                
                <div class="start-option">
                    <div class="option-icon">â–¶ï¸</div>
                    <div class="option-title">ç»§ç»­å½“å‰è¿›åº¦</div>
                    <div class="option-description">ä¿æŒå½“å‰è¿›åº¦ï¼Œç»§ç»­æœªå®Œæˆçš„å•è¯</div>
                    <button class="option-btn btn btn-success" onclick="selectGameMode('continue')">
                        ç»§ç»­æ¸¸æˆ
                    </button>
                </div>
            </div>
            
            <div class="random-word-option">
                <label class="import-option-label">
                    <input type="checkbox" id="randomWordCheckbox" class="import-option-checkbox">
                    éšæœºå•è¯æ¨¡å¼
                    <div class="import-option-description">ä»å•è¯è¡¨ä¸­éšæœºé€‰æ‹©å•è¯ï¼Œæ¯æ¬¡é€‰æ‹©ä¸é‡å¤</div>
                </label>
            </div>
            
            <div class="modal-buttons">
                <button id="closeStartModal" class="btn btn-secondary">
                    âŒ å–æ¶ˆ
                </button>
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆå®Œæˆæ¨¡æ€æ¡† -->
    <div id="gameModal" class="modal hidden">
        <div class="modal-content animate__animated">
            <h2 class="modal-title">ğŸ‰ æ­å–œå®Œæˆï¼</h2>
            <div class="modal-time" id="finalTime">0ç§’</div>
            <p class="text-white text-lg mb-4">ä½ æˆåŠŸå®Œæˆäº†æ‰€æœ‰å•è¯åŒ¹é…ï¼</p>
            <div class="modal-buttons">
                <button id="continueBtn" class="btn btn-success">
                    ğŸš€ ç»§ç»­æŒ‘æˆ˜
                </button>
                <button id="closeModal" class="btn btn-secondary">
                    âŒ å…³é—­
                </button>
            </div>
        </div>
    </div>

    <!-- Excelå¯¼å…¥é¢„è§ˆæ¨¡æ€æ¡† - ä¼˜åŒ–å¯¼å…¥å•è¯æµè§ˆç•Œé¢ -->
    <div id="excelPreviewModal" class="modal hidden">
        <div class="modal-content excel-modal animate__animated">
            <h2 class="modal-title">ğŸ“‹ å•è¯è¡¨å¯¼å…¥é¢„è§ˆ</h2>
            
            <!-- é¢„è§ˆè¡¨æ ¼ -->
            <div class="excel-preview">
                <table id="excelPreviewTable" class="excel-table">
                    <thead>
                        <tr>
                            <th>å•è¯</th>
                            <th>é‡Šä¹‰</th>
                        </tr>
                    </thead>
                    <tbody id="excelPreviewBody">
                        <!-- åŠ¨æ€å¡«å…… -->
                    </tbody>
                </table>
            </div>
            
            <!-- å¯¼å…¥é€‰é¡¹ -->
            <div class="import-options">
                <div class="import-options-title">
                    âš™ï¸ å¯¼å…¥é€‰é¡¹
                </div>
                <div class="import-option-item">
                    <input type="checkbox" id="overwriteCheckbox" class="import-option-checkbox" checked>
                    <label for="overwriteCheckbox" class="import-option-label">
                        è¦†ç›–åŸæœ‰å•è¯è¡¨
                        <div class="import-option-description">å‹¾é€‰åå°†æ›¿æ¢ç°æœ‰å•è¯è¡¨ï¼Œå¦åˆ™è¿½åŠ åˆ°ç°æœ‰å•è¯è¡¨</div>
                    </label>
                </div>
                <div class="import-option-item">
                    <input type="checkbox" id="shuffleCheckbox" class="import-option-checkbox" checked>
                    <label for="shuffleCheckbox" class="import-option-label">
                        æ‰“ä¹±å•è¯é¡ºåº
                        <div class="import-option-description">å‹¾é€‰åå°†éšæœºæ‰“ä¹±å•è¯é¡ºåºï¼Œå¦åˆ™ä¿æŒåŸæœ‰é¡ºåº</div>
                    </label>
                </div>
                <div class="import-option-item">
                    <input type="checkbox" id="skipDuplicatesCheckbox" class="import-option-checkbox">
                    <label for="skipDuplicatesCheckbox" class="import-option-label">
                        è·³è¿‡é‡å¤å•è¯
                        <div class="import-option-description">å‹¾é€‰åå°†è‡ªåŠ¨è·³è¿‡å·²å­˜åœ¨çš„å•è¯</div>
                    </label>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button id="confirmImportBtn" class="btn btn-success">
                    âœ… ç¡®è®¤å¯¼å…¥
                </button>
                <button id="cancelImportBtn" class="btn btn-secondary">
                    âŒ å–æ¶ˆ
                </button>
            </div>
        </div>
    </div>

    <!-- å•è¯è¡¨æ¨¡æ€æ¡† - ä¼˜åŒ–ç»Ÿè®¡ä¿¡æ¯å’Œå¸ƒå±€ -->
    <div id="wordListModal" class="modal hidden word-list-modal">
        <div class="modal-content animate__animated">
            <div class="word-list-header">
                <h2 class="word-list-title">ğŸ“– å•è¯è¡¨ç®¡ç†</h2>
                <button id="closeWordListBtn" class="btn btn-secondary">âŒ å…³é—­</button>
            </div>
            
            <!-- å•è¯è¡¨æœç´¢ -->
            <div class="word-list-search">
                <input type="text" id="wordListSearch" placeholder="æœç´¢å•è¯æˆ–é‡Šä¹‰...">
                <button id="wordListSearchBtn" class="btn btn-primary">ğŸ” æœç´¢</button>
                <button id="clearSearchBtn" class="btn btn-secondary">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>
            
            <!-- ç»Ÿè®¡ä¿¡æ¯æ  - æ°´å¹³å¸ƒå±€ -->
            <div class="word-stats-bar">
                <button class="stats-filter-btn active" data-filter="all" onclick="filterWordList('all')">
                    ğŸ“‹ å…¨éƒ¨ <span class="stat-count" id="totalCount">0</span>
                </button>
                <button class="stats-filter-btn" data-filter="matched" onclick="filterWordList('matched')">
                    âœ… å·²é…å¯¹ <span class="stat-count" id="matchedCount">0</span>
                </button>
                <button class="stats-filter-btn" data-filter="unmatched" onclick="filterWordList('unmatched')">
                    â³ æœªé…å¯¹ <span class="stat-count" id="unmatchedCount">0</span>
                </button>
                <button class="stats-filter-btn" data-filter="favorite" onclick="filterWordList('favorite')">
                    â¤ï¸ æ”¶è— <span class="stat-count" id="favoriteCount">0</span>
                </button>
                <button class="stats-filter-btn" data-filter="familiar" onclick="filterWordList('familiar')">
                    ğŸ˜Š ç†Ÿæ‚‰ <span class="stat-count" id="familiarCount">0</span>
                </button>
                <button class="stats-filter-btn" data-filter="vague" onclick="filterWordList('vague')">
                    ğŸ¤” æ¨¡ç³Š <span class="stat-count" id="vagueCount">0</span>
                </button>
                <button class="stats-filter-btn" data-filter="unfamiliar" onclick="filterWordList('unfamiliar')">
                    ğŸ˜µ é™Œç”Ÿ <span class="stat-count" id="unfamiliarCount">0</span>
                </button>
            </div>
            
            <div id="wordListContent" class="word-list-content">
                <!-- åŠ¨æ€å¡«å……å•è¯è¡¨ -->
            </div>
            
            <div class="modal-buttons fixed-buttons">
                <button id="exportWordsBtn" class="btn btn-secondary btn-large">
                    ğŸ“¤ å¯¼å‡ºå•è¯è¡¨
                </button>
                <button id="startMemoryBtn" class="btn btn-primary btn-large">
                    ğŸ§  å¼€å§‹è®°å¿†
                </button>
            </div>
        </div>
    </div>

    <!-- å•è¯è®°å¿†é€‰æ‹©æ¨¡æ€æ¡† - ä¼˜åŒ–è®°å¿†æ¨¡å¼é€‰æ‹©ç•Œé¢ -->
    <div id="memoryChoiceModal" class="modal hidden">
        <div class="modal-content memory-choice-modal animate__animated">
            <h2 class="memory-choice-title">é€‰æ‹©è®°å¿†æ¨¡å¼</h2>
            
            <div class="memory-choice-options">
                <button class="memory-choice-btn primary" onclick="selectMemoryMode('new')">
                    ğŸ†• é‡æ–°å¼€å§‹å­¦ä¹ 
                </button>
                <button class="memory-choice-btn secondary" onclick="selectMemoryMode('continue')">
                    ğŸ“ˆ ç»§ç»­ä¸Šæ¬¡å­¦ä¹ 
                </button>
            </div>
            
            <div class="memory-filter-section">
                <label for="memoryFilter" class="filter-label">ç­›é€‰å•è¯ç±»å‹ï¼š</label>
                <select id="memoryFilter" class="memory-filter-select">
                    <option value="all">å…¨éƒ¨å•è¯</option>
                    <option value="familiar">ç†Ÿæ‚‰çš„å•è¯</option>
                    <option value="vague">æ¨¡ç³Šçš„å•è¯</option>
                    <option value="unfamiliar">é™Œç”Ÿçš„å•è¯</option>
                </select>
            </div>
            
            <div class="modal-buttons">
                <button id="closeMemoryChoiceBtn" class="btn btn-secondary">
                    âŒ å–æ¶ˆ
                </button>
            </div>
        </div>
    </div>

    <!-- å•è¯è®°å¿†æ¨¡æ€æ¡† - ä¼˜åŒ–è®°å¿†å¡ç‰‡ç•Œé¢ -->
    <div id="wordMemoryModal" class="modal hidden">
        <div class="modal-content animate__animated">
            <h2 class="modal-title">å•è¯è®°å¿†</h2>
            
            <!-- è®°å¿†è¿›åº¦æ¡ -->
            <div class="memory-progress">
                <div class="memory-progress-text">
                    <span id="progressCurrent">1</span>/<span id="progressTotal">100</span>
                </div>
                <div class="memory-progress-bar">
                    <div class="memory-progress-fill" id="progressBarFill" style="width: 1%"></div>
                </div>
                <div class="memory-progress-text">
                    <span id="progressPercentage">1%</span>
                </div>
            </div>
            
            <!-- å•è¯è®°å¿†å¡ç‰‡ -->
            <div id="wordMemoryCard" class="word-memory-card">
                <!-- åŠ¨æ€å¡«å……å•è¯å¡ç‰‡ -->
            </div>
            
            <!-- è®°å¿†æ§åˆ¶æŒ‰é’® -->
            <div class="memory-controls">
                <button id="prevMemoryBtn" class="memory-nav-btn" onclick="prevMemoryWord()">
                    â¬…ï¸ ä¸Šä¸€ä¸ª
                </button>
                <button class="memory-nav-btn" onclick="flipCard()">
                    ğŸ”„ ç¿»è½¬
                </button>
                <button id="nextMemoryBtn" class="memory-nav-btn" onclick="nextMemoryWord()">
                    ä¸‹ä¸€ä¸ª â¡ï¸
                </button>
            </div>
            
            <!-- è®°å¿†çŠ¶æ€æŒ‰é’® -->
            <div class="memory-status-buttons">
                <button class="memory-status-btn btn-familiar" onclick="markWordStatus('familiar')">
                    ç†Ÿæ‚‰ âœ…
                </button>
                <button class="memory-status-btn btn-vague" onclick="markWordStatus('vague')">
                    æ¨¡ç³Š ğŸ¤”
                </button>
                <button class="memory-status-btn btn-unfamiliar" onclick="markWordStatus('unfamiliar')">
                    é™Œç”Ÿ âŒ
                </button>
            </div>
            
            <div class="modal-buttons">
                <button id="closeMemoryBtn" class="btn btn-secondary">
                    âŒ ç»“æŸè®°å¿†
                </button>
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆç»Ÿè®¡æ¨¡æ€æ¡† -->
    <div id="statsModal" class="modal hidden">
        <div class="modal-content animate__animated">
            <h2 class="modal-title">ğŸ“Š æ¸¸æˆç»Ÿè®¡</h2>
            
            <!-- ç»Ÿè®¡æ•°æ®å±•ç¤ºåŒºåŸŸ -->
            <div class="stats-container">
                <div class="stats-section">
                    <h3 class="stats-section-title">æ€»ä½“ç»Ÿè®¡</h3>
                    <div class="stats-grid">
                        <div class="stats-item">
                            <div class="stats-label">æ€»æ¸¸æˆæ¬¡æ•°</div>
                            <div class="stats-value" id="totalGamesPlayed">0</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-label">æ€»æ¸¸æˆæ—¶é—´</div>
                            <div class="stats-value" id="totalGameTime">0åˆ†é’Ÿ</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-label">å¹³å‡æ¯å±€æ—¶é—´</div>
                            <div class="stats-value" id="avgGameTime">0ç§’</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-label">æœ€å¿«å®Œæˆæ—¶é—´</div>
                            <div class="stats-value" id="bestGameTime">-</div>
                        </div>
                    </div>
                </div>
                
                <div class="stats-section">
                    <h3 class="stats-section-title">å•è¯ç»Ÿè®¡</h3>
                    <div class="stats-grid">
                        <div class="stats-item">
                            <div class="stats-label">æ€»å•è¯æ•°</div>
                            <div class="stats-value" id="totalWords">0</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-label">å·²å­¦ä¹ å•è¯</div>
                            <div class="stats-value" id="learnedWords">0</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-label">ç†Ÿæ‚‰å•è¯</div>
                            <div class="stats-value" id="familiarWordsCount">0</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-label">é™Œç”Ÿå•è¯</div>
                            <div class="stats-value" id="unfamiliarWordsCount">0</div>
                        </div>
                    </div>
                </div>
                
                <div class="stats-section">
                    <h3 class="stats-section-title">å­¦ä¹ è¿›åº¦</h3>
                    <div class="stats-progress">
                        <div class="stats-progress-bar">
                            <div class="stats-progress-fill" id="learningProgressBar" style="width: 0%"></div>
                        </div>
                        <div class="stats-progress-text">
                            <span id="learningProgressText">0%</span> å®Œæˆ
                        </div>
                    </div>
                </div>
                
                <div class="stats-section">
                    <h3 class="stats-section-title">æœ€è¿‘æ¸¸æˆè®°å½•</h3>
                    <div class="stats-recent-games" id="recentGames">
                        <!-- åŠ¨æ€å¡«å……æœ€è¿‘æ¸¸æˆè®°å½• -->
                        <div class="stats-no-data">æš‚æ— æ¸¸æˆè®°å½•</div>
                    </div>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button id="resetStatsBtn" class="btn btn-warning">
                    ğŸ—‘ï¸ é‡ç½®ç»Ÿè®¡
                </button>
                <button id="closeStatsBtn" class="btn btn-secondary">
                    âŒ å…³é—­
                </button>
            </div>
        </div>
    </div>

    <!-- å¯¼å…¥Excelåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="./script.js"></script>

    <script>
        // åˆ›å»ºç²’å­èƒŒæ™¯æ•ˆæœ
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            if (!particlesContainer) return;
            
            const particleCount = 50;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // æ¸¸æˆæ¨¡å¼é€‰æ‹©å‡½æ•°
        function selectGameMode(mode) {
            const modal = document.getElementById('startGameModal');
            const randomWordCheckbox = document.getElementById('randomWordCheckbox');
            
            if (modal) {
                modal.classList.add('hidden');
            }
            
            // ä¿å­˜éšæœºå•è¯æ¨¡å¼è®¾ç½®
            if (randomWordCheckbox && typeof gameState !== 'undefined') {
                gameState.settings.randomWordMode = randomWordCheckbox.checked;
                localStorage.setItem('wordGameSettings', JSON.stringify(gameState.settings));
            }
            
            if (typeof startNewGame === 'function') {
                startNewGame(mode === 'reset'); // resetæ¨¡å¼ä¸ºtrueï¼Œcontinueæ¨¡å¼ä¸ºfalse
            }
        }

        // è®°å¿†æ¨¡å¼é€‰æ‹©å‡½æ•°
        function selectMemoryMode(mode) {
            const modal = document.getElementById('memoryChoiceModal');
            const filterType = document.getElementById('memoryFilter')?.value || 'all';
            
            if (modal) {
                modal.classList.add('hidden');
            }
            
            if (typeof startWordMemory === 'function') {
                const resetMemory = (mode === 'new' || mode === 'weak' || mode === 'random');
                startWordMemory(resetMemory, filterType);
            }
        }

        // è®°å¿†æ¨¡å¼é€‰é¡¹å¡åˆ‡æ¢
        function switchMemoryTab(tabName) {
            // åˆ‡æ¢é€‰é¡¹å¡æŒ‰é’®çŠ¶æ€
            const tabButtons = document.querySelectorAll('.memory-tab-btn');
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tabName) {
                    btn.classList.add('active');
                }
            });
            
            // åˆ‡æ¢å†…å®¹åŒºåŸŸ
            const tabContents = document.querySelectorAll('.memory-tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            const targetContent = document.getElementById(tabName + 'TabContent');
            if (targetContent) {
                targetContent.classList.add('active');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–ç•Œé¢');
            
            // åˆ›å»ºç²’å­æ•ˆæœ
            createParticles();
            
            // ç¡®ä¿æ‰€æœ‰å¿…è¦çš„å…ƒç´ éƒ½å­˜åœ¨
            const requiredElements = [
                'gameTitle', 'wordCountSlider', 'wordCountDisplay', 
                'fileInput', 'importBtn', 'startBtn', 'wordListBtn', 
                'settingsBtn', 'gameBoard', 'gameTime'
            ];
            
            let missingElements = [];
            requiredElements.forEach(id => {
                if (!document.getElementById(id)) {
                    missingElements.push(id);
                }
            });
            
            if (missingElements.length > 0) {
                console.error('ç¼ºå°‘å¿…è¦å…ƒç´ :', missingElements);
            } else {
                console.log('æ‰€æœ‰å¿…è¦å…ƒç´ å·²åŠ è½½');
            }
            
            // è®¾ç½®é¢æ¿äº‹ä»¶ç›‘å¬ - ä¿®å¤è®¾ç½®æŒ‰é’®æ— å“åº”é—®é¢˜
            const settingsBtn = document.getElementById('settingsBtn');
            const closeSettings = document.getElementById('closeSettings');
            const settingsPanel = document.getElementById('settingsPanel');
            
            if (settingsBtn && settingsPanel) {
                // ç§»é™¤æ‰€æœ‰ç°æœ‰äº‹ä»¶ç›‘å¬å™¨
                settingsBtn.replaceWith(settingsBtn.cloneNode(true));
                const newSettingsBtn = document.getElementById('settingsBtn');
                
                newSettingsBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('è®¾ç½®æŒ‰é’®è¢«ç‚¹å‡»'); // è°ƒè¯•æ—¥å¿—
                    settingsPanel.classList.toggle('open');
                    if (settingsPanel.classList.contains('open')) {
                        updateAnimationSpeedDisplay();
                        if (typeof updateVoiceOptions === 'function') {
                            updateVoiceOptions();
                        }
                    }
                });
            }
            
            if (closeSettings && settingsPanel) {
                closeSettings.addEventListener('click', function() {
                    settingsPanel.classList.remove('open');
                });
            }
            
            // åŠ¨ç”»é€Ÿåº¦æ»‘å—
            const animationSpeedSlider = document.getElementById('animationSpeedSlider');
            if (animationSpeedSlider) {
                animationSpeedSlider.addEventListener('input', updateAnimationSpeedDisplay);
            }
            
            // å¼€å§‹æ¸¸æˆæŒ‰é’®äº‹ä»¶ç›‘å¬
            const startBtn = document.getElementById('startBtn');
            const startGameModal = document.getElementById('startGameModal');
            const closeStartModal = document.getElementById('closeStartModal');
            const randomWordCheckbox = document.getElementById('randomWordCheckbox');

            if (startBtn && startGameModal) {
                startBtn.addEventListener('click', function() {
                    if (typeof gameState !== 'undefined' && gameState.words.length === 0) {
                        if (typeof showToast === 'function') {
                            showToast('è¯·å…ˆå¯¼å…¥å•è¯è¡¨ï¼', 'warning');
                        } else {
                            alert('è¯·å…ˆå¯¼å…¥å•è¯è¡¨ï¼');
                        }
                        return;
                    }
                    startGameModal.classList.remove('hidden');
                    
                    // åŒæ­¥éšæœºå•è¯æ¨¡å¼è®¾ç½®
                    if (randomWordCheckbox && typeof gameState !== 'undefined') {
                        randomWordCheckbox.checked = gameState.settings.randomWordMode || false;
                    }
                });
            }

            if (closeStartModal && startGameModal) {
                closeStartModal.addEventListener('click', function() {
                    startGameModal.classList.add('hidden');
                });
            }
            
            // å•è¯è®°å¿†é€‰æ‹©æ¨¡æ€æ¡†äº‹ä»¶ç›‘å¬
            const memoryChoiceModal = document.getElementById('memoryChoiceModal');
            const closeMemoryChoiceBtn = document.getElementById('closeMemoryChoiceBtn');
            const startMemoryBtn = document.getElementById('startMemoryBtn');
            
            if (startMemoryBtn && memoryChoiceModal) {
                startMemoryBtn.addEventListener('click', function() {
                    if (typeof closeWordListModal === 'function') {
                        closeWordListModal();
                    }
                    memoryChoiceModal.classList.remove('hidden');
                });
            }
            
            if (closeMemoryChoiceBtn && memoryChoiceModal) {
                closeMemoryChoiceBtn.addEventListener('click', function() {
                    memoryChoiceModal.classList.add('hidden');
                });
            }
            
            console.log('ç•Œé¢åˆå§‹åŒ–å®Œæˆ');
        });

        // åŠ¨ç”»é€Ÿåº¦æ˜¾ç¤ºæ›´æ–°
        function updateAnimationSpeedDisplay() {
            const slider = document.getElementById('animationSpeedSlider');
            const display = document.getElementById('animationSpeedDisplay');
            if (slider && display) {
                display.textContent = slider.value + 'x';
                document.documentElement.style.setProperty('--animation-speed', slider.value);
            }
        }

        // é˜²æ­¢é¡µé¢åˆ·æ–°æ—¶çš„æ•°æ®ä¸¢å¤±è­¦å‘Š
        window.addEventListener('beforeunload', function(e) {
            if (typeof gameState !== 'undefined' && gameState.isGameActive) {
                e.preventDefault();
                e.returnValue = 'æ¸¸æˆæ­£åœ¨è¿›è¡Œä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
                return e.returnValue;
            }
        });

        // é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            // ESCé”®å…³é—­æ¨¡æ€æ¡†
            if (e.key === 'Escape') {
                const modals = [
                    'gameModal', 'excelPreviewModal', 'wordListModal', 
                    'wordMemoryModal', 'startGameModal', 'memoryChoiceModal'
                ];
                
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (modal && !modal.classList.contains('hidden')) {
                        modal.classList.add('hidden');
                    }
                });
                
                const settingsPanel = document.getElementById('settingsPanel');
                if (settingsPanel && settingsPanel.classList.contains('open')) {
                    settingsPanel.classList.remove('open');
                }
            }
            
            // ç©ºæ ¼é”®å¼€å§‹æ¸¸æˆ
            if (e.key === ' ' && typeof gameState !== 'undefined' && !gameState.isGameActive) {
                e.preventDefault();
                const startBtn = document.getElementById('startBtn');
                if (startBtn) {
                    startBtn.click();
                }
            }
            
            // Sé”®æ‰“å¼€è®¾ç½®
            if (e.key === 's' && e.ctrlKey) {
                e.preventDefault();
                const settingsPanel = document.getElementById('settingsPanel');
                if (settingsPanel) {
                    settingsPanel.classList.toggle('open');
                    updateAnimationSpeedDisplay();
                }
            }
            
            // Lé”®æ‰“å¼€å•è¯è¡¨
            if (e.key === 'l' && e.ctrlKey) {
                e.preventDefault();
                if (typeof openWordListModal === 'function') {
                    openWordListModal();
                }
            }
        });

        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('å…¨å±€é”™è¯¯:', e.error);
            if (typeof showToast === 'function') {
                showToast('å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
            } else {
                alert('å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        });

        // æœªå¤„ç†çš„Promiseé”™è¯¯
        window.addEventListener('unhandledrejection', function(e) {
            console.error('æœªå¤„ç†çš„Promiseé”™è¯¯:', e.reason);
            if (typeof showToast === 'function') {
                showToast('å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
            }
        });

        // ç½‘ç»œçŠ¶æ€æ£€æµ‹
        window.addEventListener('online', function() {
            if (typeof showToast === 'function') {
                showToast('ç½‘ç»œè¿æ¥å·²æ¢å¤', 'success');
            }
        });

        window.addEventListener('offline', function() {
            if (typeof showToast === 'function') {
                showToast('ç½‘ç»œè¿æ¥å·²æ–­å¼€ï¼Œæ¸¸æˆå¯ç¦»çº¿è¿è¡Œ', 'warning');
            }
        });

        // é˜²æ­¢åŒå‡»ç¼©æ”¾
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>